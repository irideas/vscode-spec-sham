import{_ as s,c as l,o as a,ae as n}from"./chunks/framework.B_lm770W.js";const g=JSON.parse('{"title":"VS Code Configuration Settings UI 子系统软件设计说明书 (SDD)","description":"","frontmatter":{},"headers":[],"relativePath":"configuration-system/configuration-settings-ui-sdd.md","filePath":"configuration-system/configuration-settings-ui-sdd.md","lastUpdated":1765349849000}'),e={name:"configuration-system/configuration-settings-ui-sdd.md"};function t(h,i,p,r,k,o){return a(),l("div",null,[...i[0]||(i[0]=[n(`<h1 id="vs-code-configuration-settings-ui-子系统软件设计说明书-sdd" tabindex="-1">VS Code Configuration Settings UI 子系统软件设计说明书 (SDD) <a class="header-anchor" href="#vs-code-configuration-settings-ui-子系统软件设计说明书-sdd" aria-label="Permalink to &quot;VS Code Configuration Settings UI 子系统软件设计说明书 (SDD)&quot;">​</a></h1><h2 id="_1-设计目标与约束" tabindex="-1">1. 设计目标与约束 <a class="header-anchor" href="#_1-设计目标与约束" aria-label="Permalink to &quot;1. 设计目标与约束&quot;">​</a></h2><h3 id="_1-1-设计目标" tabindex="-1">1.1 设计目标 <a class="header-anchor" href="#_1-1-设计目标" aria-label="Permalink to &quot;1.1 设计目标&quot;">​</a></h3><ul><li>为用户提供统一、可搜索、可过滤的配置入口，覆盖 Settings UI 与 settings.json 两种编辑方式；</li><li>将 Configuration Core 的复杂性（schema、分层、语言覆盖、Profile、Remote、Policy、Sync）隐藏在 UI 背后，只暴露必要且易懂的信息；</li><li>确保 Settings UI 与 JSON 编辑行为始终一致，任何一方的修改都能正确反映到另一方；</li><li>保持与 VS Code 现有产品体验一致，不破坏既有命令、快捷键和用户习惯。</li></ul><h3 id="_1-2-约束条件" tabindex="-1">1.2 约束条件 <a class="header-anchor" href="#_1-2-约束条件" aria-label="Permalink to &quot;1.2 约束条件&quot;">​</a></h3><ul><li><p>必须对齐 VS Code 既有行为和 API：</p><ul><li>Settings Editor / Settings UI 的入口、布局、User/Workspace tab 等；</li><li><code>workbench.settings.editor</code> 控制 UI / JSON 模式；</li><li>各种「Open Settings (JSON/UI)」命令。</li></ul></li><li><p>必须依赖 Configuration Core：</p><ul><li>通过 Configuration Service 获取 ConfigurationModel、inspect 信息；</li><li>通过访问与变更子系统写入设置；</li><li>不直接操作 settings.json 文件。</li></ul></li><li><p>必须复用 JSON 语言服务：</p><ul><li>settings.json 的 IntelliSense 与校验由 JSON 语言服务提供；</li><li>Settings UI 负责选择正确 schema 并激活对应语言服务配置。</li></ul></li></ul><hr><h2 id="_2-组件设计" tabindex="-1">2. 组件设计 <a class="header-anchor" href="#_2-组件设计" aria-label="Permalink to &quot;2. 组件设计&quot;">​</a></h2><h3 id="_2-1-settingseditorshell" tabindex="-1">2.1 SettingsEditorShell <a class="header-anchor" href="#_2-1-settingseditorshell" aria-label="Permalink to &quot;2.1 SettingsEditorShell&quot;">​</a></h3><ul><li><p>负责 Settings Editor 页签的整体容器与生命周期：</p><ul><li>处理打开 / 关闭请求；</li><li>根据 <code>workbench.settings.editor</code> 和用户操作决定使用 UI 还是 JSON 模式；</li><li>管理 User / Workspace / Folder / Profile / Remote 视图切换；</li><li>订阅配置变更事件并协调子组件刷新。</li></ul></li></ul><h3 id="_2-2-scopeswitcher" tabindex="-1">2.2 ScopeSwitcher <a class="header-anchor" href="#_2-2-scopeswitcher" aria-label="Permalink to &quot;2.2 ScopeSwitcher&quot;">​</a></h3><ul><li><p>UI 顶部的 scope 切换控件：</p><ul><li>状态：<code>&#39;user&#39; | &#39;workspace&#39; | &#39;folder&#39; | &#39;profile&#39; | &#39;remote&#39; | ...</code>；</li><li>根据当前 workspace / profile / remote 状态决定可用选项；</li><li>向 SettingsViewController 广播 scope 变更事件，触发重新绑定配置视图。</li></ul></li></ul><h3 id="_2-3-settingssearchbar-filtercontroller" tabindex="-1">2.3 SettingsSearchBar &amp; FilterController <a class="header-anchor" href="#_2-3-settingssearchbar-filtercontroller" aria-label="Permalink to &quot;2.3 SettingsSearchBar &amp; FilterController&quot;">​</a></h3><ul><li><p>SettingsSearchBar：</p><ul><li>提供文本输入框和 filter 按钮；</li><li>捕获用户输入并交给 FilterController 解析。</li></ul></li><li><p>FilterController：</p><ul><li><p>将输入拆分为：</p><ul><li>普通关键字数组；</li><li>filter token 列表（如 modifiedOnly / extIds / languageIds 等）；</li></ul></li><li><p>向 SettingsViewModel 提供当前 filter 状态。</p></li></ul></li></ul><h3 id="_2-4-settingstreeview-settingsitemview" tabindex="-1">2.4 SettingsTreeView &amp; SettingsItemView <a class="header-anchor" href="#_2-4-settingstreeview-settingsitemview" aria-label="Permalink to &quot;2.4 SettingsTreeView &amp; SettingsItemView&quot;">​</a></h3><ul><li><p>SettingsTreeView：</p><ul><li>按 schema 提供的类别 / group 构建树形或分组视图；</li><li>支持折叠 / 展开、虚拟滚动。</li></ul></li><li><p>SettingsItemView：</p><ul><li><p>渲染单条 setting：</p><ul><li>标题、描述；</li><li>控件（checkbox / textbox / dropdown / slider / color picker / …）；</li><li>修改标记、重置按钮；</li><li>Policy / Sync 状态图标。</li></ul></li><li><p>将用户操作通过 SettingsBindingController 转成配置更新请求。</p></li></ul></li></ul><h3 id="_2-5-settingsviewcontroller" tabindex="-1">2.5 SettingsViewController <a class="header-anchor" href="#_2-5-settingsviewcontroller" aria-label="Permalink to &quot;2.5 SettingsViewController&quot;">​</a></h3><ul><li><p>控制 Settings UI 整体数据流的中介：</p><ul><li>根据 scope、search、filter 组合，构建 SettingsViewModel；</li><li>监听 ConfigurationChangeEvent，局部刷新受影响的 SettingItemViewModel；</li><li>承接「打开 JSON」命令，调用 JsonSettingsOpener。</li></ul></li></ul><h3 id="_2-6-jsonsettingsopener" tabindex="-1">2.6 JsonSettingsOpener <a class="header-anchor" href="#_2-6-jsonsettingsopener" aria-label="Permalink to &quot;2.6 JsonSettingsOpener&quot;">​</a></h3><ul><li><p>封装从 UI 打开 settings.json 的逻辑：</p><ul><li>根据当前 scope 决定要打开的文件 URI（User / Workspace / Folder / Profile）；</li><li>调用 editor service 打开该文件；</li><li>确保 JSON 语言服务附带正确的 schema（如通过 language configuration 绑定）。</li></ul></li></ul><h3 id="_2-7-settingsbindingcontroller" tabindex="-1">2.7 SettingsBindingController <a class="header-anchor" href="#_2-7-settingsbindingcontroller" aria-label="Permalink to &quot;2.7 SettingsBindingController&quot;">​</a></h3><ul><li><p>管理 UI 控件与 Configuration API 的双向绑定：</p><ul><li>初始化控件时，通过 Configuration Service 获取当前值；</li><li>响应控件变更，调用 <code>WorkspaceConfiguration.update</code>；</li><li>处理 update 过程中的错误与 loading 状态；</li><li>在配置变更事件到达时，更新控件值与修改标记。</li></ul></li></ul><h3 id="_2-8-policyindicator-syncstatusprovider" tabindex="-1">2.8 PolicyIndicator / SyncStatusProvider <a class="header-anchor" href="#_2-8-policyindicator-syncstatusprovider" aria-label="Permalink to &quot;2.8 PolicyIndicator / SyncStatusProvider&quot;">​</a></h3><ul><li><p>PolicyIndicator：</p><ul><li>使用 Policy 系统提供的接口查询某 setting 是否被策略锁定；</li><li>将锁定状态注入 SettingItemViewModel，用于禁用控件和展示提示。</li></ul></li><li><p>SyncStatusProvider：</p><ul><li>从 Sync 系统或 schema 中获取 ignoreSync 等状态；</li><li>在 UI 中展示「参与 / 不参与同步」等信息（可选）。</li></ul></li></ul><hr><h2 id="_3-数据模型设计" tabindex="-1">3. 数据模型设计 <a class="header-anchor" href="#_3-数据模型设计" aria-label="Permalink to &quot;3. 数据模型设计&quot;">​</a></h2><h3 id="_3-1-settingsviewmodel" tabindex="-1">3.1 SettingsViewModel <a class="header-anchor" href="#_3-1-settingsviewmodel" aria-label="Permalink to &quot;3.1 SettingsViewModel&quot;">​</a></h3><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SettingsScopeId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;user&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;workspace&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;folder&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;profile&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;remote&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ActiveFilters</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  modifiedOnly</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  extensionIds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  languageIds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  featureIds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SettingsViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  scope</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SettingsScopeId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  searchText</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  filters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ActiveFilters</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 当前展示的设置项（已经应用 search + filter）</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  displayedSettings</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SettingItemViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 用于左侧树或分组视图</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  groups</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SettingsGroupViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SettingsGroupViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  children</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SettingsGroupViewModel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SettingItemViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)[];</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  collapsible</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-2-settingitemviewmodel" tabindex="-1">3.2 SettingItemViewModel <a class="header-anchor" href="#_3-2-settingitemviewmodel" aria-label="Permalink to &quot;3.2 SettingItemViewModel&quot;">​</a></h3><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LayerValues</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  workspace</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  folder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  languageDefault</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  languageUser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  languageWorkspace</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  languageFolder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  policy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ValueSource</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;default&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;user&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;workspace&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;folder&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;language&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;policy&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ControlType</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;boolean&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;number&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;string&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;enum&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;object&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;array&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;color&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;complex&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SettingItemViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;                  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Setting ID, 如 &quot;editor.fontSize&quot;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 显示标题（本地化）</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 文本或 markdown 渲染后结果</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  controlType</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ControlType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  enumOptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }[];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 当前 scope 下的有效值</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 各层值，用于 tooltip / 详情</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  layerValues</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LayerValues</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 当前值主要来自哪个层</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  valueSource</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ValueSource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  modified</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 相对默认 / 下层是否已显式修改</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  policyLocked</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 是否被策略锁定</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  syncIgnored</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 是否被 Sync 忽略（可选）</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];             </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 如 usesOnlineServices 等</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  extensionId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 贡献该 setting 的扩展</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  categoryId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 左侧分类用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-3-与-configuration-model-的映射" tabindex="-1">3.3 与 Configuration Model 的映射 <a class="header-anchor" href="#_3-3-与-configuration-model-的映射" aria-label="Permalink to &quot;3.3 与 Configuration Model 的映射&quot;">​</a></h3><ul><li>SettingsViewController 通过声明子系统获取 schema 列表；</li><li>再通过 Configuration Service 的 <code>inspect</code> 接口获取每个 setting 的各层值；</li><li>将 schema + inspect 结果合成为 SettingItemViewModel；</li><li>search / filter 操作用于从完整的 ViewModel 集合中筛选 displayedSettings。</li></ul><hr><h2 id="_4-核心流程设计" tabindex="-1">4. 核心流程设计 <a class="header-anchor" href="#_4-核心流程设计" aria-label="Permalink to &quot;4. 核心流程设计&quot;">​</a></h2><h3 id="_4-1-打开-settings-ui-流程" tabindex="-1">4.1 打开 Settings UI 流程 <a class="header-anchor" href="#_4-1-打开-settings-ui-流程" aria-label="Permalink to &quot;4.1 打开 Settings UI 流程&quot;">​</a></h3><ol><li><p>用户通过菜单 / 命令 / 快捷键发起「打开设置」操作；</p></li><li><p>SettingsEditorShell：</p><ul><li>读取 <code>workbench.settings.editor</code>；</li><li>若配置为 JSON，则委托 JsonSettingsOpener 打开 User settings.json，流程结束；</li><li>否则创建 SettingsViewController，进入 UI 模式。</li></ul></li><li><p>ScopeSwitcher 决定初始 scope（例如：有 workspace 时记住上次 scope，否则为 User）；</p></li><li><p>SettingsViewController：</p><ul><li>从声明子系统获取所有注册 settings 的 schema；</li><li>通过 Configuration Service 为当前 scope 构建 SettingItemViewModel 集合；</li><li>初始化 SettingsViewModel（searchText 为空，filters 默认值）；</li></ul></li><li><p>SettingsTreeView 渲染 groups 与 displayedSettings，Settings UI 准备就绪。</p></li></ol><h3 id="_4-2-搜索与过滤流程" tabindex="-1">4.2 搜索与过滤流程 <a class="header-anchor" href="#_4-2-搜索与过滤流程" aria-label="Permalink to &quot;4.2 搜索与过滤流程&quot;">​</a></h3><ol><li><p>用户在搜索框输入文本或 filter token；</p></li><li><p>SettingsSearchBar 将输入交给 FilterController；</p></li><li><p>FilterController：</p><ul><li>解析出 searchText 与 ActiveFilters；</li><li>通知 SettingsViewController 更新 SettingsViewModel.filters 和 searchText。</li></ul></li><li><p>SettingsViewController 重新计算 displayedSettings：</p><ul><li>先按 label/ID/description 匹配 searchText；</li><li>再按 ActiveFilters（modifiedOnly / extensionIds / languageIds 等）过滤；</li></ul></li><li><p>SettingsTreeView 根据新的 displayedSettings 重新渲染列表（支持虚拟滚动）。</p></li></ol><h3 id="_4-3-在-ui-中修改设置流程" tabindex="-1">4.3 在 UI 中修改设置流程 <a class="header-anchor" href="#_4-3-在-ui-中修改设置流程" aria-label="Permalink to &quot;4.3 在 UI 中修改设置流程&quot;">​</a></h3><ol><li><p>用户在某个 SettingItemView 上修改控件值（例如切换布尔开关）；</p></li><li><p>SettingsItemView 将新值交给 SettingsBindingController；</p></li><li><p>SettingsBindingController：</p><ul><li>基于当前 scope 推导 ConfigurationTarget（User / Workspace / Folder 等）；</li><li>如处于特定语言视图，则设置 overrideInLanguage 标志；</li><li>调用 <code>WorkspaceConfiguration.update(settingId, newValue, target, overrideInLanguage)</code>；</li><li>处理 update 的 Promise（显示 loading / 错误提示）。</li></ul></li><li><p>访问与变更子系统：</p><ul><li>进行 schema 校验和 Policy 检查；</li><li>调用存储与分层子系统写入 settings.json；</li><li>刷新 ConfigurationModel 并触发 ConfigurationChangeEvent。</li></ul></li><li><p>SettingsEditorShell 订阅到 ConfigurationChangeEvent 后：</p><ul><li>将受影响 settingId 列表传给 SettingsViewController；</li><li>SettingsViewController 为这些 setting 重新调用 inspect，更新其 SettingItemViewModel；</li><li>SettingsTreeView 仅重绘受影响条目，更新 value、modified、valueSource 等。</li></ul></li></ol><h3 id="_4-4-json-编辑与-ui-同步流程" tabindex="-1">4.4 JSON 编辑与 UI 同步流程 <a class="header-anchor" href="#_4-4-json-编辑与-ui-同步流程" aria-label="Permalink to &quot;4.4 JSON 编辑与 UI 同步流程&quot;">​</a></h3><ol><li><p>用户通过 Settings UI 中的 JSON 按钮或命令打开 settings.json；</p></li><li><p>JsonSettingsOpener：</p><ul><li>确定当前 scope 的 settings.json 路径；</li><li>打开编辑器，并确保 JSON 语言服务加载对应 schema；</li></ul></li><li><p>用户编辑 JSON 并保存；</p></li><li><p>存储与分层子系统：</p><ul><li>检测文件变更，尝试解析新内容；</li><li>若 JSON 有语法错误，则保留旧模型并在编辑器中标记错误；</li><li>若解析成功，更新对应层的 ConfigurationModel 并触发 ConfigurationChangeEvent。</li></ul></li><li><p>SettingsEditorShell 收到事件：</p><ul><li>通知 SettingsViewController 根据变更的 settingId 更新对应 SettingItemViewModel；</li><li>SettingsTreeView 中的相关 setting 值与修改标记更新；</li><li><code>@modified</code> 过滤结果随之变化。</li></ul></li></ol><h3 id="_4-5-policy-与-sync-状态展示流程" tabindex="-1">4.5 Policy 与 Sync 状态展示流程 <a class="header-anchor" href="#_4-5-policy-与-sync-状态展示流程" aria-label="Permalink to &quot;4.5 Policy 与 Sync 状态展示流程&quot;">​</a></h3><ol><li><p>构建 SettingItemViewModel 时，SettingsViewController：</p><ul><li>调用 PolicyIndicator 查询 setting 在当前 scope 是否被策略锁定及锁定类型；</li><li>调用 SyncStatusProvider 查询 setting 是否被 Sync 忽略。</li></ul></li><li><p>SettingItemViewModel 中填充 <code>policyLocked</code> / <code>syncIgnored</code> 等字段；</p></li><li><p>SettingsItemView 根据这些字段：</p><ul><li>对策略锁定项禁用控件，显示锁定图标和说明；</li><li>对 Sync 状态（如「不同步」）显示提示（可选）。</li></ul></li></ol><hr><h2 id="_5-错误与边界处理" tabindex="-1">5. 错误与边界处理 <a class="header-anchor" href="#_5-错误与边界处理" aria-label="Permalink to &quot;5. 错误与边界处理&quot;">​</a></h2><h3 id="_5-1-更新错误" tabindex="-1">5.1 更新错误 <a class="header-anchor" href="#_5-1-更新错误" aria-label="Permalink to &quot;5.1 更新错误&quot;">​</a></h3><ul><li><p>若 update 因以下原因失败：</p><ul><li>schema 校验失败（类型、枚举等）；</li><li>Policy 禁止修改；</li><li>对应 scope 不存在（如没有 workspace 却写入 Workspace 设置）；</li><li>文件权限或 I/O 错误；</li></ul></li><li><p>SettingsBindingController 必须：</p><ul><li>在 UI 中显示错误提示（toast 或内联错误）；</li><li>恢复控件显示为实际有效值（而非用户尝试写入但失败的值）；</li><li>不触发「成功修改」标记或 <code>@modified</code> 状态变更。</li></ul></li></ul><h3 id="_5-2-json-语法错误" tabindex="-1">5.2 JSON 语法错误 <a class="header-anchor" href="#_5-2-json-语法错误" aria-label="Permalink to &quot;5.2 JSON 语法错误&quot;">​</a></h3><ul><li><p>当 settings.json 语法错误时：</p><ul><li>存储与分层子系统保留上一版本模型；</li><li>JSON 编辑器通过 JSON 语言服务标记错误；</li><li>Settings UI 可以通过 banner 或状态栏提示用户「当前 settings.json 无法解析」；</li><li>在用户修复并保存前，Settings UI 仍然基于旧模型展示配置。</li></ul></li></ul><h3 id="_5-3-scope-缺失与降级行为" tabindex="-1">5.3 scope 缺失与降级行为 <a class="header-anchor" href="#_5-3-scope-缺失与降级行为" aria-label="Permalink to &quot;5.3 scope 缺失与降级行为&quot;">​</a></h3><ul><li><p>当没有打开 workspace：</p><ul><li>ScopeSwitcher 禁用 Workspace / Folder 视图；</li><li>尝试打开 Workspace settings.json 的命令应提示用户需要打开 folder/workspace。</li></ul></li><li><p>在 Remote/Container 未连接时：</p><ul><li>Remote scope 对应视图禁用或隐藏；</li><li>已有 UI 状态应正确降级到本地 scope。</li></ul></li></ul><hr><h2 id="_6-性能与缓存策略" tabindex="-1">6. 性能与缓存策略 <a class="header-anchor" href="#_6-性能与缓存策略" aria-label="Permalink to &quot;6. 性能与缓存策略&quot;">​</a></h2><ul><li><p>对 SettingItemViewModel：</p><ul><li>在 SettingsViewController 中缓存完整集合，只在必要时重建；</li><li>搜索与过滤仅在缓存集合上操作，使用高效的索引结构。</li></ul></li><li><p>对 ConfigurationModel 查询：</p><ul><li>使用 Configuration Service 提供的面向 scope 的缓存；</li><li>在 ConfigurationChangeEvent 中精确标出受影响 settingId，避免全量刷新；</li></ul></li><li><p>对 SettingsTreeView 渲染：</p><ul><li>使用虚拟列表技术，只渲染可见区域；</li><li>对大类折叠时不构建其子树的 ViewModel，按需加载。</li></ul></li></ul><hr><h2 id="_7-无障碍与国际化设计" tabindex="-1">7. 无障碍与国际化设计 <a class="header-anchor" href="#_7-无障碍与国际化设计" aria-label="Permalink to &quot;7. 无障碍与国际化设计&quot;">​</a></h2><ul><li><p>所有可交互控件（搜索框、filter 按钮、scope 切换、SettingItemView 中的控件）必须：</p><ul><li>有清晰的键盘焦点顺序；</li><li>显示焦点样式；</li><li>设置符合语义的 aria 属性；</li></ul></li><li><p>Settings UI 中所有提示、描述、错误信息均通过本地化资源提供；</p></li><li><p>Setting ID 保持英文不变，仅 label/description 本地化。</p></li></ul><hr><h2 id="_8-扩展性与演进" tabindex="-1">8. 扩展性与演进 <a class="header-anchor" href="#_8-扩展性与演进" aria-label="Permalink to &quot;8. 扩展性与演进&quot;">​</a></h2><ul><li><p>过滤能力扩展：</p><ul><li>支持更多 filter token（如 <code>@tag:formatting</code>、<code>@feature:testing</code> 等）；</li><li>SettingsSearchBar 与 FilterController 设计为解析插件式过滤规则。</li></ul></li><li><p>视图模式扩展：</p><ul><li>未来可以加入「按 Feature」「按扩展」等视图模式；</li><li>通过扩展 SettingsGroupViewModel 和 SettingsTreeView 的布局逻辑实现。</li></ul></li><li><p>Profiles 深度集成：</p><ul><li>支持在 Settings UI 中快速切换 Profile 并对比差异；</li><li>对 Profile 特有设置提供专门的视图或筛选。</li></ul></li></ul><hr><h2 id="_9-与其他子系统的接口" tabindex="-1">9. 与其他子系统的接口 <a class="header-anchor" href="#_9-与其他子系统的接口" aria-label="Permalink to &quot;9. 与其他子系统的接口&quot;">​</a></h2><ul><li><p>与 Configuration 声明子系统：</p><ul><li>通过 schema registry 获取所有 settings schema；</li><li>支持 schema 变更时动态刷新 UI（例如扩展启用 / 禁用）。</li></ul></li><li><p>与 Configuration 访问与变更子系统：</p><ul><li>通过 Configuration Service 提供的 <code>getConfiguration</code> / <code>inspect</code> / <code>update</code> / 配置变更事件构建与更新 UI。</li></ul></li><li><p>与 Configuration 存储与分层子系统：</p><ul><li>间接依赖，用于获取多层值与 JSON 解析错误等信息；</li><li>不直接操作文件路径与 watcher。</li></ul></li><li><p>与 Settings Sync / Enterprise Policy 系统：</p><ul><li>通过 PolicyIndicator / SyncStatusProvider 的抽象接口获取状态；</li><li>保证 UI 显示与实际有效值和策略状态一致。</li></ul></li></ul><hr><h2 id="_10-测试建议" tabindex="-1">10. 测试建议 <a class="header-anchor" href="#_10-测试建议" aria-label="Permalink to &quot;10. 测试建议&quot;">​</a></h2><ul><li><p>单元测试：</p><ul><li>FilterController 对不同输入解析的正确性；</li><li>SettingsViewController 对 ConfigurationModel/Schema 的映射；</li><li>SettingsBindingController 对不同 scope/update 组合的行为。</li></ul></li><li><p>集成测试：</p><ul><li>打开 Settings UI、修改设置、检查有效值与 JSON 内容；</li><li>在 JSON 中修改 settings、检查 UI 值与 <code>@modified</code> 行为；</li><li>多根工作区、Profile、Remote 场景下 scope 切换与写入路径；</li><li>Policy 锁定与 Sync 状态展示。</li></ul></li></ul><hr>`,68)])])}const c=s(e,[["render",t]]);export{g as __pageData,c as default};
