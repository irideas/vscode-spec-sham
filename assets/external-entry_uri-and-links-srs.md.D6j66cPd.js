import{_ as a,c as i,o as r,ae as o}from"./chunks/framework.B_lm770W.js";const m=JSON.parse('{"title":"URI 与外部链接需求规格说明书 (SRS)","description":"","frontmatter":{},"headers":[],"relativePath":"external-entry/uri-and-links-srs.md","filePath":"external-entry/uri-and-links-srs.md","lastUpdated":1765187623000}'),l={name:"external-entry/uri-and-links-srs.md"};function d(t,e,n,c,s,h){return r(),i("div",null,[...e[0]||(e[0]=[o('<h1 id="uri-与外部链接需求规格说明书-srs" tabindex="-1">URI 与外部链接需求规格说明书 (SRS) <a class="header-anchor" href="#uri-与外部链接需求规格说明书-srs" aria-label="Permalink to &quot;URI 与外部链接需求规格说明书 (SRS)&quot;">​</a></h1><h2 id="_1-引言" tabindex="-1">1. 引言 <a class="header-anchor" href="#_1-引言" aria-label="Permalink to &quot;1. 引言&quot;">​</a></h2><p>本文定义 VS Code 外部入口与 URI 相关能力的事实规范：<code>window.registerUriHandler</code>、<code>onUri</code> 激活、<code>vscode.env.uriScheme</code>、<code>asExternalUri</code>、<code>openExternal</code>，以及与安全/远程环境相关的约束。适用于所有消费方（Tree View、Editor、Webview、Terminal、Debug 等），Tree View 协作模式在后文摘要并在 Tree View 小册子中作引用。</p><h2 id="_2-能力范围与基线" tabindex="-1">2. 能力范围与基线 <a class="header-anchor" href="#_2-能力范围与基线" aria-label="Permalink to &quot;2. 能力范围与基线&quot;">​</a></h2><ul><li>引擎基线：默认 <code>engines.vscode</code> ≥ 1.80，包含 URI Handler 与 checkbox/Views Welcome 等相关特性；Remote/Web/Codespaces 需考虑 URI 重写与端口/authority 变更。</li><li>能力边界：系统级 URI Handler、外部深链生成/解析、Remote/Web <code>asExternalUri</code> 重写、<code>openExternal</code> 调用。</li></ul><h2 id="_3-平台级事实" tabindex="-1">3. 平台级事实 <a class="header-anchor" href="#_3-平台级事实" aria-label="Permalink to &quot;3. 平台级事实&quot;">​</a></h2><h3 id="_3-1-uri-handler-生命周期" tabindex="-1">3.1 URI Handler 生命周期 <a class="header-anchor" href="#_3-1-uri-handler-生命周期" aria-label="Permalink to &quot;3.1 URI Handler 生命周期&quot;">​</a></h3><ul><li>扩展通过 <code>window.registerUriHandler</code> 注册单例；<code>onUri</code> 激活事件在收到目标 URI 时触发扩展。</li><li>对出现在 <code>contributes.commands</code> 的命令，VS Code 自动处理命令激活，无需重复声明 <code>onCommand</code>；仅未声明或兼容旧引擎时手写。</li></ul><h3 id="_3-2-scheme-与环境行为" tabindex="-1">3.2 Scheme 与环境行为 <a class="header-anchor" href="#_3-2-scheme-与环境行为" aria-label="Permalink to &quot;3.2 Scheme 与环境行为&quot;">​</a></h3><ul><li><code>vscode.env.uriScheme</code> 提供当前产品线的 scheme（如 vscode/vscode-insiders，Web 场景可能不同）；生成深链时应使用该值而非硬编码。</li><li><code>vscode.env.asExternalUri</code> 在 Remote/Web/Codespaces 下重写 URI，使客户端可访问（端口/authority 可能变化）；Desktop 本地场景通常返回原值。</li><li><code>vscode.env.openExternal</code> 请求操作系统/浏览器打开外部 URI。</li></ul><h3 id="_3-3-协议与安全约束" tabindex="-1">3.3 协议与安全约束 <a class="header-anchor" href="#_3-3-协议与安全约束" aria-label="Permalink to &quot;3.3 协议与安全约束&quot;">​</a></h3><ul><li>参数解析需使用 <code>URL/URLSearchParams</code>，对 query/path 做白名单校验，禁止直接拼接为 Shell/文件路径。</li><li>破坏性操作（删除/覆盖/推送）必须经用户确认对话框；敏感信息不得出现在可共享 URI。</li><li>URI Handler 结束后，应清理敏感上下文/状态。</li></ul><h2 id="_4-通用应用模式-非-tree-专属" tabindex="-1">4. 通用应用模式（非 Tree 专属） <a class="header-anchor" href="#_4-通用应用模式-非-tree-专属" aria-label="Permalink to &quot;4. 通用应用模式（非 Tree 专属）&quot;">​</a></h2><ul><li>OAuth/设备登录回调：浏览器 → <code>asExternalUri</code> 重写 → <code>onUri</code> → 存储凭证/刷新状态。</li><li>从网页/IM/脚本打开 VS Code 资源：<code>vscode.env.uriScheme://&lt;extId&gt;/open?...</code> → 执行命令或打开 Editor/Webview。</li><li>远程/代码空间入口：外部链接唤起 VS Code 客户端并连接到远程环境（需配合 <code>asExternalUri</code>）。</li></ul><h2 id="_5-tree-view-协作摘要" tabindex="-1">5. Tree View 协作摘要 <a class="header-anchor" href="#_5-tree-view-协作摘要" aria-label="Permalink to &quot;5. Tree View 协作摘要&quot;">​</a></h2><ul><li>Deep Link → Service → <code>TreeView.reveal</code>，需确保 Provider 已注册、容器可见（可调用 <code>workbench.view.extension.&lt;container&gt;</code>）。</li><li>节点生成分享链接：使用 <code>uriScheme</code> 构造，包含视图/节点 ID/过滤参数；复制后他人可点击定位。</li><li>上下文键/菜单/快捷键：URI 触发后可能需要同步上下文键以驱动 Tree View 菜单/快捷键状态。</li></ul><h2 id="_6-用例-归档" tabindex="-1">6. 用例（归档） <a class="header-anchor" href="#_6-用例-归档" aria-label="Permalink to &quot;6. 用例（归档）&quot;">​</a></h2><ul><li>UC-URI-01：告警/通知深链到特定节点/资源。</li><li>UC-URI-02：复制分享链接（含视图/过滤参数）。</li><li>UC-URI-03：外部浏览器 OAuth/设备登录回 VS Code 刷新状态。</li><li>UC-URI-04：批量节点/资源跳转并执行命令。</li></ul><h2 id="_7-未来扩展-占位" tabindex="-1">7. 未来扩展（占位） <a class="header-anchor" href="#_7-未来扩展-占位" aria-label="Permalink to &quot;7. 未来扩展（占位）&quot;">​</a></h2><ul><li>PR/Issue/Review 深链到 Editor/SCM 视图。</li><li>Chat/Terminal/Debug 入口的统一 URI 约定。</li><li>Remote/Tunnel 下的多实例路由策略。</li></ul>',20)])])}const _=a(l,[["render",d]]);export{m as __pageData,_ as default};
