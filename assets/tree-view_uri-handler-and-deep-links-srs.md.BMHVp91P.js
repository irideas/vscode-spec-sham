import{_ as r,c as a,o,ae as l}from"./chunks/framework.B_lm770W.js";const m=JSON.parse('{"title":"URI Handler 与深链协同 SRS（Tree View 专篇）","description":"","frontmatter":{},"headers":[],"relativePath":"tree-view/uri-handler-and-deep-links-srs.md","filePath":"tree-view/uri-handler-and-deep-links-srs.md","lastUpdated":1765282194000}'),i={name:"tree-view/uri-handler-and-deep-links-srs.md"};function t(d,e,n,c,s,h){return o(),a("div",null,[...e[0]||(e[0]=[l('<h1 id="uri-handler-与深链协同-srs-tree-view-专篇" tabindex="-1">URI Handler 与深链协同 SRS（Tree View 专篇） <a class="header-anchor" href="#uri-handler-与深链协同-srs-tree-view-专篇" aria-label="Permalink to &quot;URI Handler 与深链协同 SRS（Tree View 专篇）&quot;">​</a></h1><p>本章只描述 Tree View 与外部入口协同时的“事实性需求”。平台级协议（URI Handler 生命周期、<code>uriScheme</code>、<code>asExternalUri</code>、安全模型等）位于 <a href="/vscode-spec-sham/external-entry/uri-and-links-srs.html">外部入口 SRS</a>，Tree 侧用例与设计优先级高于平台用例，平台文档如需消费侧细节应引用本章。</p><h2 id="_1-引言" tabindex="-1">1. 引言 <a class="header-anchor" href="#_1-引言" aria-label="Permalink to &quot;1. 引言&quot;">​</a></h2><h3 id="_1-1-目的" tabindex="-1">1.1 目的 <a class="header-anchor" href="#_1-1-目的" aria-label="Permalink to &quot;1.1 目的&quot;">​</a></h3><p>定义 Tree View 在处理外部 URI/深链时必须遵守的可验证约束，确保节点定位、上下文同步与安全体验一致。</p><h3 id="_1-2-范围" tabindex="-1">1.2 范围 <a class="header-anchor" href="#_1-2-范围" aria-label="Permalink to &quot;1.2 范围&quot;">​</a></h3><ul><li>激活与可见性：<code>onUri</code> 激活、视图容器切换、Provider 注册时机；</li><li>节点标识与查找：稳定主键、<code>resolveNodeById</code>、<code>getParent</code> 路径复原；</li><li>Reveal 与上下文：<code>TreeView.reveal</code> 调用条件、上下文键同步、菜单/快捷键状态；</li><li>链接生成：<code>vscode.env.uriScheme</code>、高风险操作确认；</li><li>性能/错误：刷新粒度、异常提示。<br> （URI 解析/安全/Remote 重写等平台行为参见外部入口 SRS）</li></ul><h3 id="_1-3-术语-tree-侧" tabindex="-1">1.3 术语（Tree 侧） <a class="header-anchor" href="#_1-3-术语-tree-侧" aria-label="Permalink to &quot;1.3 术语（Tree 侧）&quot;">​</a></h3><ul><li><strong>节点主键（Node Key）</strong>：稳定标识，如资源 ID/路径，用于 URI 参数与内部映射。</li><li><strong>落点路径（Reveal Path）</strong>：从根到目标节点的链路，供 <code>getParent</code>/<code>reveal</code> 使用。</li><li><strong>上下文键同步</strong>：深链落点后，<code>view == &lt;id&gt;</code>、<code>viewItem == &lt;contextValue&gt;</code> 等应与手动点击一致。</li></ul><h3 id="_1-4-关联文档与用例" tabindex="-1">1.4 关联文档与用例 <a class="header-anchor" href="#_1-4-关联文档与用例" aria-label="Permalink to &quot;1.4 关联文档与用例&quot;">​</a></h3><ul><li>平台 SRS/SDD：<a href="/vscode-spec-sham/external-entry/uri-and-links-srs.html">uri-and-links-srs</a>、<a href="/vscode-spec-sham/external-entry/uri-and-links-sdd.html">uri-and-links-sdd</a></li><li>安全/信任占位：<a href="/vscode-spec-sham/external-entry/auth-and-trust-srs.html">auth-and-trust-srs</a> / <a href="/vscode-spec-sham/external-entry/auth-and-trust-sdd.html">auth-and-trust-sdd</a></li><li>Remote/Web 占位：<a href="/vscode-spec-sham/external-entry/remote-routing-srs.html">remote-routing-srs</a> / <a href="/vscode-spec-sham/external-entry/remote-routing-sdd.html">remote-routing-sdd</a></li><li>Tree 主用例：<strong>UC-TREE-06</strong>（深度链接定位树节点，见 <code>tree-view-srs.md</code>）；成本/告警等场景在 UC-TREE-02/05 中也引用深链。</li></ul><h2 id="_2-前置事实假设" tabindex="-1">2. 前置事实假设 <a class="header-anchor" href="#_2-前置事实假设" aria-label="Permalink to &quot;2. 前置事实假设&quot;">​</a></h2><ol><li>命令激活：声明于 <code>contributes.commands</code> 的命令执行时自动触发 <code>onCommand:&lt;id&gt;</code> 激活，无需重复写入 <code>activationEvents</code>。</li><li>视图可见性：Tree View 可被移动到不同容器；扩展不得假定固定容器位置。</li><li><code>TreeItem.collapsibleState</code> 为 <code>None</code> 时 Workbench 不会调用 <code>getChildren</code>；展开箭头由 <code>collapsibleState</code> 控制。</li></ol><h2 id="_3-tree-view-协同的硬性需求" tabindex="-1">3. Tree View 协同的硬性需求 <a class="header-anchor" href="#_3-tree-view-协同的硬性需求" aria-label="Permalink to &quot;3. Tree View 协同的硬性需求&quot;">​</a></h2><ol><li><strong>激活与注册</strong>：<code>onUri</code> 激活后需确保目标 Provider 已注册；如依赖 <code>onView:&lt;id&gt;</code>，必须在 Handler 中显式确保视图可见，否则 reveal 可能被丢弃。</li><li><strong>容器切换</strong>：若视图不在当前容器，调用 <code>workbench.view.extension.&lt;container&gt;</code> 将其置为可见；切换后再调用 <code>reveal</code>。</li><li><strong>节点查找</strong>：Provider 必须提供基于节点主键的查找方法（如 <code>resolveNodeById</code>）并支持未加载节点的延迟获取；查找失败需提示并避免静默失败。</li><li><strong>路径复原</strong>：若 <code>reveal</code> 需要父链，<code>getParent</code> 应可返回完整路径或通过 Service 构建路径，避免依赖 UI 选中状态。</li><li><strong>上下文键同步</strong>：通过 URI 选中/聚焦节点后，上下文键应与手动点击等价，保证菜单/快捷键 when 条件正确；多选场景需与 Tree View 当前 selection 一致。</li><li><strong>链接生成</strong>：Tree 侧生成的深链必须使用 <code>vscode.env.uriScheme</code>（不可硬编码 <code>vscode://</code>），参数用 <code>URLSearchParams</code>；涉及删除/覆盖等高风险行为需在消费端显式确认。</li><li><strong>性能与错误</strong>：<code>handleUri</code> 中不得执行阻塞式重 IO；可异步加载并提示“正在定位/未找到”；异常应提示并记录日志，不得吞错。</li></ol><h2 id="_4-协作场景-tree-视角-用例落点" tabindex="-1">4. 协作场景（Tree 视角，用例落点） <a class="header-anchor" href="#_4-协作场景-tree-视角-用例落点" aria-label="Permalink to &quot;4. 协作场景（Tree 视角，用例落点）&quot;">​</a></h2><h3 id="uc-tree-06-bridge" tabindex="-1">4.1 UC-TREE-06 深度链接定位节点 <a class="header-anchor" href="#uc-tree-06-bridge" aria-label="Permalink to &quot;4.1 UC-TREE-06 深度链接定位节点 {#uc-tree-06-bridge}&quot;">​</a></h3><ol><li>外部入口生成深链（含视图 ID、节点主键、可选过滤器），用户点击触发 <code>onUri</code>。</li><li>Handler 校验参数 → 保证 Provider 已注册、视图可见（必要时执行容器切换）。</li><li>Service 按主键查找节点，必要时恢复父链；未找到时提示并可提供 fallback（如打开搜索）。</li><li>调用 <code>TreeView.reveal(node, { expand: true, select: true, focus: true })</code>；同步上下文键，使菜单/快捷键生效。</li><li>可选：刷新相关区域（遥测、状态消息），避免重复刷新整棵树。</li></ol><h3 id="uc-tree-05-bridge" tabindex="-1">4.2 UC-TREE-05 成本分析分享（含深链） <a class="header-anchor" href="#uc-tree-05-bridge" aria-label="Permalink to &quot;4.2 UC-TREE-05 成本分析分享（含深链） {#uc-tree-05-bridge}&quot;">​</a></h3><ol><li>节点右键或命令生成分享链接（视图 ID + 节点主键 + 过滤参数），写入剪贴板。</li><li>接收方点击链接，按 4.1 流程落点；若配置不同，可提示差异或应用默认配置。</li><li>高风险（删除/重置预算）需在消费端确认。</li></ol><h3 id="uc-tree-02-bridge" tabindex="-1">4.3 UC-TREE-02 资源/告警跳转 <a class="header-anchor" href="#uc-tree-02-bridge" aria-label="Permalink to &quot;4.3 UC-TREE-02 资源/告警跳转 {#uc-tree-02-bridge}&quot;">​</a></h3><ol><li>外部告警/资源入口携带节点主键 → 激活扩展 → 容器切换。</li><li>Provider 通过主键解析资源节点，按 4.1 流程 reveal；未找到时提示“资源不存在/无权限”。</li></ol><h2 id="_5-兼容性与边界" tabindex="-1">5. 兼容性与边界 <a class="header-anchor" href="#_5-兼容性与边界" aria-label="Permalink to &quot;5. 兼容性与边界&quot;">​</a></h2><ul><li>基线：默认 <code>engines.vscode</code> ≥ 1.80，涵盖 URI Handler、Views Welcome、Tree checkbox。更低版本需验证 URI/checkbox 行为差异。</li><li>多窗口/热重载：<code>TreeItem.command.arguments</code> 不会被持久化；深链参数需可重建。</li><li>Remote/Web：深链生成需配合平台 <code>asExternalUri</code>（见外部入口 SRS），Tree 侧仅消费解析后的 URI。</li></ul><h2 id="_6-未来演进-记录需求-非当前事实" tabindex="-1">6. 未来演进（记录需求，非当前事实） <a class="header-anchor" href="#_6-未来演进-记录需求-非当前事实" aria-label="Permalink to &quot;6. 未来演进（记录需求，非当前事实）&quot;">​</a></h2><ul><li>若 VS Code 提供“深链落点路径面包屑”或“reveal 前置可见性回调”，本章将补充约束。</li><li>若平台新增新的入口协议（如聊天/Terminal 链接），Tree 侧的上下文同步与容器切换规则需扩展。</li></ul>',26)])])}const b=r(i,[["render",t]]);export{m as __pageData,b as default};
