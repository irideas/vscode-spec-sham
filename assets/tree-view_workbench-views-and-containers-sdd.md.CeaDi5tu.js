import{_ as s,c as a,o as n,ae as h}from"./chunks/framework.B_lm770W.js";const o=JSON.parse('{"title":"Workbench 视图与容器软件设计说明书 (SDD)","description":"","frontmatter":{},"headers":[],"relativePath":"tree-view/workbench-views-and-containers-sdd.md","filePath":"tree-view/workbench-views-and-containers-sdd.md","lastUpdated":1765282498000}'),e={name:"tree-view/workbench-views-and-containers-sdd.md"};function t(l,i,k,p,r,d){return n(),a("div",null,[...i[0]||(i[0]=[h(`<h1 id="workbench-视图与容器软件设计说明书-sdd" tabindex="-1">Workbench 视图与容器软件设计说明书 (SDD) <a class="header-anchor" href="#workbench-视图与容器软件设计说明书-sdd" aria-label="Permalink to &quot;Workbench 视图与容器软件设计说明书 (SDD)&quot;">​</a></h1><h2 id="_1-文档目的" tabindex="-1">1. 文档目的 <a class="header-anchor" href="#_1-文档目的" aria-label="Permalink to &quot;1. 文档目的&quot;">​</a></h2><p>给出 VS Code Workbench 中视图容器（View Containers）与 Tree View 协同的实现策略，帮助平台与扩展团队在 Activity Bar、Side Bar、Panel 等区域上构建一致、可维护的视图体验。本文以设计建议与模式为主，非 VS Code 平台的硬性约束。</p><h2 id="_2-与-tree-view-的关系概述" tabindex="-1">2. 与 Tree View 的关系概述 <a class="header-anchor" href="#_2-与-tree-view-的关系概述" aria-label="Permalink to &quot;2. 与 Tree View 的关系概述&quot;">​</a></h2><ul><li>Tree View 必须挂载在容器之下，由容器负责可见性、焦点、布局及上下文键（<code>view == &lt;id&gt;</code>）。</li><li>容器决定 <code>onView:&lt;id&gt;</code> 激活时机、标题栏按钮区域与 Collapse All 控件。</li><li>容器切换/隐藏事件应驱动 TreeDataProvider 的资源释放或刷新逻辑。</li></ul><h2 id="_2-5-使用者视角与典型场景" tabindex="-1">2.5 使用者视角与典型场景 <a class="header-anchor" href="#_2-5-使用者视角与典型场景" aria-label="Permalink to &quot;2.5 使用者视角与典型场景&quot;">​</a></h2><ul><li><strong>云运维 / 资源浏览者</strong>：期望在 Activity Bar 的“Cloud Center”容器中查看多棵树（资产、日志、监控），需要容器可见性钩子暂停/恢复轮询。</li><li><strong>测试/调试团队</strong>：将“测试结果”树停靠在 Panel，关注宽屏布局、多选与标题栏命令的排列。</li><li><strong>FinOps / 分析团队</strong>：喜欢把成本树迁移到自定义容器，要求容器工厂能统一管理多视图并暴露 <code>workbench.view.extension.&lt;container&gt;</code> 命令，方便视图间切换。</li></ul><h2 id="_3-架构总览" tabindex="-1">3. 架构总览 <a class="header-anchor" href="#_3-架构总览" aria-label="Permalink to &quot;3. 架构总览&quot;">​</a></h2><h3 id="_3-1-workbench-shell" tabindex="-1">3.1 Workbench Shell <a class="header-anchor" href="#_3-1-workbench-shell" aria-label="Permalink to &quot;3.1 Workbench Shell&quot;">​</a></h3><ul><li>负责渲染 Activity Bar、Side Bar、Panel 等 UI 区域。</li><li>调用 View Container Manager 读取扩展注册的 Descriptor 并渲染。</li></ul><h3 id="_3-2-view-container-manager" tabindex="-1">3.2 View Container Manager <a class="header-anchor" href="#_3-2-view-container-manager" aria-label="Permalink to &quot;3.2 View Container Manager&quot;">​</a></h3><ul><li>保存 <code>ViewContainer</code> → <code>ViewDescriptor</code> 映射，处理视图排序、拖放、持久化。</li><li>向上下文服务发出 <code>activeViewlet</code>, <code>activePanel</code>, <code>view == &lt;id&gt;</code> 等键。</li></ul><h3 id="_3-3-view-descriptor-registry" tabindex="-1">3.3 View Descriptor Registry <a class="header-anchor" href="#_3-3-view-descriptor-registry" aria-label="Permalink to &quot;3.3 View Descriptor Registry&quot;">​</a></h3><ul><li>从扩展 Manifest 解析 <code>contributes.viewsContainers</code> 与 <code>views</code>。</li><li>支持运行时添加/移除视图（比如 Experiments），并触发 UI 更新。</li></ul><h3 id="_3-4-view-location-抽象" tabindex="-1">3.4 View Location 抽象 <a class="header-anchor" href="#_3-4-view-location-抽象" aria-label="Permalink to &quot;3.4 View Location 抽象&quot;">​</a></h3><ul><li>视图最终呈现在 Sidebar / Panel / Auxiliary Bar 等位置，Container 是逻辑集合，位置由 Workbench 布局控制；</li><li>视图从 Sidebar 迁移到 Panel 不会触发重新激活，仅更新位置与焦点，上下文键随位置变化。</li></ul><h2 id="_4-设计考虑" tabindex="-1">4. 设计考虑 <a class="header-anchor" href="#_4-设计考虑" aria-label="Permalink to &quot;4. 设计考虑&quot;">​</a></h2><h3 id="_4-1-布局持久化" tabindex="-1">4.1 布局持久化 <a class="header-anchor" href="#_4-1-布局持久化" aria-label="Permalink to &quot;4.1 布局持久化&quot;">​</a></h3><ul><li>使用 <code>StorageService</code> 保存容器顺序、侧栏位置、视图可见性；</li><li>Tree View 自身的展开状态由 Tree View 组件管理，容器只保存“当前可见视图”。</li></ul><h3 id="_4-2-容器激活路由" tabindex="-1">4.2 容器激活路由 <a class="header-anchor" href="#_4-2-容器激活路由" aria-label="Permalink to &quot;4.2 容器激活路由&quot;">​</a></h3><ul><li><code>workbench.view.explorer</code> 等命令调用 View Service 打开目标容器；</li><li>自定义容器应提供 <code>workbench.view.extension.&lt;containerId&gt;</code> 命令供命令面板/快捷键使用；</li><li>Tree View 需要在 <code>treeView.onDidChangeVisibility</code> 响应容器切换。</li></ul><h3 id="_4-3-上下文键传播" tabindex="-1">4.3 上下文键传播 <a class="header-anchor" href="#_4-3-上下文键传播" aria-label="Permalink to &quot;4.3 上下文键传播&quot;">​</a></h3><ul><li>容器激活时设置 <code>activeViewlet</code>、<code>view == &lt;id&gt;</code> 等上下文键；</li><li>Tree View 事件（selection、visibility）可进一步触发扩展自定义上下文，用于菜单/快捷键控制。</li><li>焦点链路：视图获得焦点后，<code>view == &lt;id&gt;</code>/<code>focusedView == &lt;id&gt;</code> 置为 true，供 Commands/Keybindings 章节引用。</li></ul><h2 id="_5-推荐实现模式" tabindex="-1">5. 推荐实现模式 <a class="header-anchor" href="#_5-推荐实现模式" aria-label="Permalink to &quot;5. 推荐实现模式&quot;">​</a></h2><h3 id="_5-1-容器工厂-tree-view-适配器" tabindex="-1">5.1 容器工厂 + Tree View 适配器 <a class="header-anchor" href="#_5-1-容器工厂-tree-view-适配器" aria-label="Permalink to &quot;5.1 容器工厂 + Tree View 适配器&quot;">​</a></h3><p><strong>目的</strong>：将多个 Tree View 注册到统一的自定义容器，并集中处理 visibility 与命令的桥接。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ViewSpec</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">provider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vscode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TreeDataProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ContainerFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> views</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vscode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TreeView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">spec</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ViewSpec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> treeView</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vscode.window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createTreeView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(spec.id, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      treeDataProvider: spec.provider,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      showCollapseAll: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    treeView.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onDidChangeVisibility</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      vscode.commands.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">executeCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;setContext&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">spec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}.visible\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, e.visible);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.views.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(spec.id, treeView);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  dispose</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.views.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">view</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> view.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dispose</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> activate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vscode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ExtensionContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> factory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ContainerFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  factory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cloudAssets&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, provider: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CloudTreeProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  factory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cloudLogs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, provider: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LogTreeProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ctx.subscriptions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(factory);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_5-2-viewvisibilitycoordinator" tabindex="-1">5.2 ViewVisibilityCoordinator <a class="header-anchor" href="#_5-2-viewvisibilitycoordinator" aria-label="Permalink to &quot;5.2 ViewVisibilityCoordinator&quot;">​</a></h3><p><strong>目的</strong>：在容器切换时暂停或恢复 Tree View 后台任务（轮询、订阅），节省资源。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ViewVisibilityCoordinator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> view</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vscode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TreeView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> provider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RefreshableProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    view.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onDidChangeVisibility</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.visible </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onShow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onHide</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onShow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.provider.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.provider.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">refresh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onHide</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.provider.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pause</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> provider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TelemetryTreeProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> view</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vscode.window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createTreeView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;telemetryDiagnostics&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { treeDataProvider: provider });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ViewVisibilityCoordinator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(view, provider);</span></span></code></pre></div><h3 id="_5-3-多视图集线器-multi-view-hub" tabindex="-1">5.3 多视图集线器 (Multi-View Hub) <a class="header-anchor" href="#_5-3-多视图集线器-multi-view-hub" aria-label="Permalink to &quot;5.3 多视图集线器 (Multi-View Hub)&quot;">​</a></h3><p><strong>目的</strong>：在 Activity Bar 自定义容器内注册多个 Tree View，并在标题栏中放置统一的切换命令。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MultiViewHub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> activeView</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;cloudAssets&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> containerId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  registerToggleCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">command</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">targetView</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vscode.commands.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registerCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(command, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.activeView </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> targetView;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      vscode.commands.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">executeCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`workbench.view.extension.\${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">containerId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      vscode.commands.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">executeCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;setContext&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`\${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">containerId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}.activeView\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, targetView);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> hub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MultiViewHub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cloudCenter&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hub.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registerToggleCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cloudCenter.showAssets&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cloudAssets&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hub.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registerToggleCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cloudCenter.showLogs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cloudLogs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="_6-运行时考量" tabindex="-1">6. 运行时考量 <a class="header-anchor" href="#_6-运行时考量" aria-label="Permalink to &quot;6. 运行时考量&quot;">​</a></h2><ul><li>在 <code>activate</code> 期间延迟注册大型 Tree View，等容器可见后再创建 Provider；</li><li>当容器被用户拖动到 Panel/Side Bar，扩展不应假定固定位置；</li><li>所有 <code>TreeView</code> 和事件处理器需正确清理，避免窗口关闭后泄漏。</li></ul><h2 id="_7-未来演进" tabindex="-1">7. 未来演进 <a class="header-anchor" href="#_7-未来演进" aria-label="Permalink to &quot;7. 未来演进&quot;">​</a></h2><ul><li>官方提供容器级别事件（如 onDidMoveView）供扩展监听；</li><li>在面板区域支持网格布局，以同时停靠多个 Tree View；</li><li>允许扩展定义容器主题/色板，提升品牌一致性。</li></ul><h2 id="_8-端到端实施清单" tabindex="-1">8. 端到端实施清单 <a class="header-anchor" href="#_8-端到端实施清单" aria-label="Permalink to &quot;8. 端到端实施清单&quot;">​</a></h2><ol><li><strong>Manifest</strong>：确认容器 ID、图标、视图 ID 一致，并提供 <code>workbench.view.extension.&lt;container&gt;</code> 切换命令；</li><li><strong>Provider 注册</strong>：延迟到容器首次可见时创建，避免无谓消耗；</li><li><strong>Visibility Hook</strong>：绑定 <code>onDidChangeVisibility</code>，在隐藏时停止轮询并释放句柄；</li><li><strong>命令/菜单</strong>：为标题栏按钮/上下文菜单配置 <code>when: view == &lt;id&gt;</code> 并遵守排序；</li><li><strong>恢复验证</strong>：测试容器拖动到 Panel、窗口重启后的布局恢复以及 URI/命令跳转路径。</li></ol>`,39)])])}const g=s(e,[["render",t]]);export{o as __pageData,g as default};
