import{_ as a,c as l,o as i,ae as t}from"./chunks/framework.B_lm770W.js";const _=JSON.parse('{"title":"外部入口安全与信任 SDD（平台供给域）","description":"","frontmatter":{},"headers":[],"relativePath":"external-entry/auth-and-trust-sdd.md","filePath":"external-entry/auth-and-trust-sdd.md","lastUpdated":1765282194000}'),o={name:"external-entry/auth-and-trust-sdd.md"};function r(n,e,d,c,h,s){return i(),l("div",null,[...e[0]||(e[0]=[t('<h1 id="外部入口安全与信任-sdd-平台供给域" tabindex="-1">外部入口安全与信任 SDD（平台供给域） <a class="header-anchor" href="#外部入口安全与信任-sdd-平台供给域" aria-label="Permalink to &quot;外部入口安全与信任 SDD（平台供给域）&quot;">​</a></h1><p>提供入口安全/信任的设计建议：参数校验、签名/一次性 token、防重放、隐私与日志、破坏性操作确认，以及 Remote/Web 环境差异的处理。消费侧需结合本章方案与各自域的 UI/业务要求。</p><h2 id="_1-设计目标" tabindex="-1">1. 设计目标 <a class="header-anchor" href="#_1-设计目标" aria-label="Permalink to &quot;1. 设计目标&quot;">​</a></h2><ul><li>入口可验证、可追踪：参数来源可控，错误可诊断。</li><li>安全默认拒绝：校验失败或来源未知时，不执行副作用。</li><li>低耦合：安全校验与业务处理分层，便于复用与测试。</li></ul><h2 id="_2-参考实现模式" tabindex="-1">2. 参考实现模式 <a class="header-anchor" href="#_2-参考实现模式" aria-label="Permalink to &quot;2. 参考实现模式&quot;">​</a></h2><h3 id="_2-1-入口校验管线" tabindex="-1">2.1 入口校验管线 <a class="header-anchor" href="#_2-1-入口校验管线" aria-label="Permalink to &quot;2.1 入口校验管线&quot;">​</a></h3><ol><li>解析：<code>URL/URLSearchParams</code>，白名单字段，类型/长度校验。</li><li>认证：签名/HMAC 或一次性 token（含 timestamp/nonce）；检查过期、防重放（nonce 存储/窗口内缓存）。</li><li>授权：匹配允许的 action/view/command 列表，最小权限执行。</li><li>风险分级：为 destructive 操作标记高风险，强制用户确认。</li><li>调度：通过命令/Service 执行；失败统一收口提示 + 日志/遥测。</li></ol><h3 id="_2-2-token-签名建议" tabindex="-1">2.2 Token/签名建议 <a class="header-anchor" href="#_2-2-token-签名建议" aria-label="Permalink to &quot;2.2 Token/签名建议&quot;">​</a></h3><ul><li>签名字段（如 <code>sig</code>）基于固定排序的参数 + 时间戳 + nonce，使用 HMAC-SHA256；服务端/生成端与扩展共享密钥。</li><li>一次性 token 存储最近使用记录（内存/SecretStorage），防止短时间重复。</li><li>过期时间明确（如 5–10 分钟），过期即拒绝并提示。</li></ul><h3 id="_2-3-破坏性操作确认" tabindex="-1">2.3 破坏性操作确认 <a class="header-anchor" href="#_2-3-破坏性操作确认" aria-label="Permalink to &quot;2.3 破坏性操作确认&quot;">​</a></h3><ul><li>明确 action 与影响对象（如 “删除资源 X”）；二次确认或需要用户输入关键字（视场景而定）。</li><li>对自动执行的批量操作，提供预览/列表，并允许用户取消。</li><li>在命令/Service 层防二次触发（节流/幂等）。</li></ul><h3 id="_2-4-隐私与日志" tabindex="-1">2.4 隐私与日志 <a class="header-anchor" href="#_2-4-隐私与日志" aria-label="Permalink to &quot;2.4 隐私与日志&quot;">​</a></h3><ul><li>URI 中不包含凭证/个人数据；必要参数使用短期 token。</li><li>日志/遥测只记录去标识化数据（action、结果码、耗时），不记录原始 query；可存哈希值用于排查。</li><li>异常信息对用户友好，避免暴露内部结构。</li></ul><h3 id="_2-5-remote-web-codespaces-考虑" tabindex="-1">2.5 Remote/Web/Codespaces 考虑 <a class="header-anchor" href="#_2-5-remote-web-codespaces-考虑" aria-label="Permalink to &quot;2.5 Remote/Web/Codespaces 考虑&quot;">​</a></h3><ul><li>生成共享链接前先调用 <code>asExternalUri</code>，对重写后的 URI 再做签名/校验（签名应覆盖重写后的完整 URL）。</li><li>不信任来源 IP；验证完全依赖 token/签名。</li><li>若代理/隧道导致链接不可达，应提供降级提示或本地打开选项。</li></ul><h2 id="_3-反模式" tabindex="-1">3. 反模式 <a class="header-anchor" href="#_3-反模式" aria-label="Permalink to &quot;3. 反模式&quot;">​</a></h2><ul><li>在 Handler 中直接执行副作用，无校验/无确认。</li><li>将敏感 token 直接放入 URI 或日志。</li><li>忽略 nonce/ttl，导致重放攻击。</li><li>依赖本地/内网 IP 作为信任依据，在 Remote/Web 环境下失效。</li></ul><h2 id="_4-检查清单" tabindex="-1">4. 检查清单 <a class="header-anchor" href="#_4-检查清单" aria-label="Permalink to &quot;4. 检查清单&quot;">​</a></h2><ul><li>[ ] 入口字段白名单、必填、长度/类型校验。</li><li>[ ] 签名/一次性 token 校验，含时间戳/nonce，具备防重放。</li><li>[ ] 高风险 action 强制确认，支持取消/幂等。</li><li>[ ] 不泄漏敏感信息到 URI/日志/提示。</li><li>[ ] Remote/Web 使用 <code>asExternalUri</code> 后的 URL 做签名/验证，异常有提示。</li><li>[ ] 错误统一提示与遥测收口。</li></ul><h2 id="_5-测试与验证建议-占位" tabindex="-1">5. 测试与验证建议（占位） <a class="header-anchor" href="#_5-测试与验证建议-占位" aria-label="Permalink to &quot;5. 测试与验证建议（占位）&quot;">​</a></h2><ul><li>覆盖参数校验/签名/nonce/ttl/重放保护；Remote/Web <code>asExternalUri</code> 生成与签名一致性；高风险确认弹框。</li></ul><h2 id="_6-演进" tabindex="-1">6. 演进 <a class="header-anchor" href="#_6-演进" aria-label="Permalink to &quot;6. 演进&quot;">​</a></h2><ul><li>提供可复用的验证/签名 SDK 与安全策略配置。</li><li>引入“高风险入口”统一 UI 提示或系统级确认。</li><li>多实例/多租户的 nonce/凭证隔离策略。</li></ul>',23)])])}const m=a(o,[["render",r]]);export{_ as __pageData,m as default};
