<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>URI Handler &amp; Deep Links 软件设计说明书 (SDD) | VS Code 规格与设计</title>
    <meta name="description" content="以“假装 Visual Studio Code 官方团队”的身份，汇总关键能力的事实需求（SRS）与设计指导（SDD）">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.DvYjeyDV.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.izza3oQ9.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.C3zd6p6B.js">
    <link rel="modulepreload" href="/assets/chunks/framework.BQlYxExx.js">
    <link rel="modulepreload" href="/assets/vscode-tree-view-spec_uri-handler-and-deep-links-sdd.md.DMCA_iQ7.lean.js">
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>VS Code 规格与设计</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vscode-tree-view-spec/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Tree View 生态</span><!--]--></a><!--]--><!--]--></nav><!----><!----><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/irideas/vscode-spec-sham" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><!----><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/irideas/vscode-spec-sham" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Tree View 生态</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vscode-tree-view-spec/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>章节总览</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>核心 API｜Tree View 主域</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vscode-tree-view-spec/tree-view-srs.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>事实需求 SRS</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vscode-tree-view-spec/tree-view-sdd.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>设计指导 SDD</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Workbench 视图与容器</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vscode-tree-view-spec/workbench-views-and-containers-srs.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>事实需求 SRS</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vscode-tree-view-spec/workbench-views-and-containers-sdd.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>设计指导 SDD</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>命令 / 菜单 / 快捷键</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vscode-tree-view-spec/commands-menus-and-keybindings-srs.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>事实需求 SRS</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vscode-tree-view-spec/commands-menus-and-keybindings-sdd.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>设计指导 SDD</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>激活与上下文系统</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vscode-tree-view-spec/activation-and-context-system-srs.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>事实需求 SRS</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vscode-tree-view-spec/activation-and-context-system-sdd.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>设计指导 SDD</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>配置与设置</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vscode-tree-view-spec/configuration-and-settings-srs.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>事实需求 SRS</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vscode-tree-view-spec/configuration-and-settings-sdd.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>设计指导 SDD</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>URI Handler 与深链</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vscode-tree-view-spec/uri-handler-and-deep-links-srs.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>事实需求 SRS</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/vscode-tree-view-spec/uri-handler-and-deep-links-sdd.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>设计指导 SDD</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _vscode-tree-view-spec_uri-handler-and-deep-links-sdd" data-v-39a288b8><div><h1 id="uri-handler-deep-links-软件设计说明书-sdd" tabindex="-1">URI Handler &amp; Deep Links 软件设计说明书 (SDD) <a class="header-anchor" href="#uri-handler-deep-links-软件设计说明书-sdd" aria-label="Permalink to &quot;URI Handler &amp; Deep Links 软件设计说明书 (SDD)&quot;">​</a></h1><h2 id="_1-文档目的" tabindex="-1">1. 文档目的 <a class="header-anchor" href="#_1-文档目的" aria-label="Permalink to &quot;1. 文档目的&quot;">​</a></h2><p>提供在 VS Code 中实现 <code>vscode://</code> URI Handler、外部调用管线与 Tree View 深度链接的设计指南，涵盖安全校验、Reveal 流程与模式示例。</p><h2 id="_2-与-tree-view-的关系概述" tabindex="-1">2. 与 Tree View 的关系概述 <a class="header-anchor" href="#_2-与-tree-view-的关系概述" aria-label="Permalink to &quot;2. 与 Tree View 的关系概述&quot;">​</a></h2><ul><li>Tree View 可生成 URI 带上视图/节点信息供外部系统跳转；</li><li>URI Handler 解析节点 ID 后需调用 <code>TreeView.reveal</code>，因此必须和 Provider 缓存/<code>getParent</code> 协同；</li><li>URI 还可触发命令或设置上下文键，影响 Tree View UI。</li></ul><h2 id="_2-5-使用者视角与典型场景" tabindex="-1">2.5 使用者视角与典型场景 <a class="header-anchor" href="#_2-5-使用者视角与典型场景" aria-label="Permalink to &quot;2.5 使用者视角与典型场景&quot;">​</a></h2><ul><li><strong>云告警/运维</strong>：在邮件或 IM 中点击 <code>vscode://cloud-ext/reveal</code>，期望直接定位到 Cloud Assets 树节点并获取失败反馈。</li><li><strong>FinOps 成本分析</strong>：复制成本节点的深链分享给同事，需要在目标 VS Code（Stable/Insiders）均能打开，并保留筛选参数。</li><li><strong>OAuth/设备登录</strong>：浏览器登录后跳回 VS Code，刷新 Tree View 中的凭证节点并提示当前账号状态，关注 <code>env.asExternalUri</code> 与 token 校验流程。</li></ul><h2 id="_3-架构概览" tabindex="-1">3. 架构概览 <a class="header-anchor" href="#_3-架构概览" aria-label="Permalink to &quot;3. 架构概览&quot;">​</a></h2><h3 id="_3-1-uri-handler-service" tabindex="-1">3.1 URI Handler Service <a class="header-anchor" href="#_3-1-uri-handler-service" aria-label="Permalink to &quot;3.1 URI Handler Service&quot;">​</a></h3><ul><li>VS Code 核心在接收到 <code>vscode://&lt;extid&gt;</code> 时定位扩展并调用其 <code>handleUri</code>；</li><li>扩展需使用 <code>window.registerUriHandler</code> 注册单例。</li></ul><h3 id="_3-2-external-uri-pipeline" tabindex="-1">3.2 External URI Pipeline <a class="header-anchor" href="#_3-2-external-uri-pipeline" aria-label="Permalink to &quot;3.2 External URI Pipeline&quot;">​</a></h3><ul><li><code>env.asExternalUri</code> 把 <code>vscode://</code> 映射为 HTTPS 代理链接，供浏览器/OAuth 使用；</li><li>回调进入 VS Code 后由 Handler 再次解析。</li></ul><h3 id="_3-3-tree-view-integration-layer" tabindex="-1">3.3 Tree View Integration Layer <a class="header-anchor" href="#_3-3-tree-view-integration-layer" aria-label="Permalink to &quot;3.3 Tree View Integration Layer&quot;">​</a></h3><ul><li>Provider 提供 <code>resolveNodeById</code>/<code>getCachedNode</code>；</li><li>TreeView 控制 <code>reveal</code>、<code>selection</code>、<code>message</code> 展示状态；</li><li>可能需要命令/上下文键准备视图。</li></ul><h2 id="_4-设计细节" tabindex="-1">4. 设计细节 <a class="header-anchor" href="#_4-设计细节" aria-label="Permalink to &quot;4. 设计细节&quot;">​</a></h2><h3 id="_4-1-uri-schema-与验证" tabindex="-1">4.1 URI Schema 与验证 <a class="header-anchor" href="#_4-1-uri-schema-与验证" aria-label="Permalink to &quot;4.1 URI Schema 与验证&quot;">​</a></h3><ul><li>建议使用结构化路径（<code>/reveal</code>, <code>/auth</code>, <code>/action/&lt;name&gt;</code>）；</li><li>query 参数采用 <code>URLSearchParams</code> 解析，严格校验；</li><li>对敏感操作要求签名或一次性 token。</li></ul><h3 id="_4-2-参数到节点映射" tabindex="-1">4.2 参数到节点映射 <a class="header-anchor" href="#_4-2-参数到节点映射" aria-label="Permalink to &quot;4.2 参数到节点映射&quot;">​</a></h3><ul><li>Provider 维护 <code>{ id → TreeNode }</code> 缓存，并在 <code>getChildren</code>、<code>resolveTreeItem</code> 中填充；</li><li>若节点不在缓存，需递归获取父节点构造路径；</li><li>Reveal 失败时应提示用户并提供 fallback（比如打开搜索）。</li></ul><h3 id="_4-3-安全与权限提示" tabindex="-1">4.3 安全与权限提示 <a class="header-anchor" href="#_4-3-安全与权限提示" aria-label="Permalink to &quot;4.3 安全与权限提示&quot;">​</a></h3><ul><li>URI 若触发破坏性命令，必须 <code>showWarningMessage</code> 提示确认；</li><li>对外部来源的 URI 需防止开放重定向或参数注入；</li><li>Handler 结束后要清理敏感上下文键。</li></ul><h2 id="_5-推荐实现模式" tabindex="-1">5. 推荐实现模式 <a class="header-anchor" href="#_5-推荐实现模式" aria-label="Permalink to &quot;5. 推荐实现模式&quot;">​</a></h2><h3 id="_5-1-reveal-on-uri-flow" tabindex="-1">5.1 reveal-on-URI Flow <a class="header-anchor" href="#_5-1-reveal-on-uri-flow" aria-label="Permalink to &quot;5.1 reveal-on-URI Flow&quot;">​</a></h3><p><strong>目标</strong>：解析 URI → 打开容器 → Reveal 节点。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RevealController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> viewId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> view</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vscode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TreeView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> provider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolveNodeById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ) {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reveal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">nodeId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vscode.commands.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">executeCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`workbench.view.extension.${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.provider.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolveNodeById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(nodeId);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">node) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      vscode.window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">showWarningMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`未找到节点 ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nodeId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.view.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reveal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node, { expand: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, select: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, focus: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RevealController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cloudCenter&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, treeView, provider);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vscode.window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registerUriHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleUri</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">uri</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (uri.path </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/reveal&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nodeId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URLSearchParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uri.query).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nodeId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nodeId) { vscode.window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">showErrorMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;缺少 nodeId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> controller.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reveal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(nodeId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="_5-2-deep-link-generation-helper" tabindex="-1">5.2 Deep Link Generation Helper <a class="header-anchor" href="#_5-2-deep-link-generation-helper" aria-label="Permalink to &quot;5.2 Deep Link Generation Helper&quot;">​</a></h3><p><strong>目标</strong>：集中生成符合 schema 的链接，可集成命令/菜单。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LinkBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> extensionId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">view</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">nodeId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">extras</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Record</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> query</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URLSearchParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ view, nodeId, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">extras });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vscode.Uri.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`vscode://${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">extensionId</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/reveal?${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> builder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LinkBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cloud-ext&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vscode.commands.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registerCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cloudAssets.copyLink&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CloudNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> uri</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cloudAssets&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, node.id, { region: node.region });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  vscode.env.clipboard.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeText</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uri.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  vscode.window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">showInformationMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;已复制链接&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="_5-3-external-auth-tree-selection" tabindex="-1">5.3 External Auth + Tree Selection <a class="header-anchor" href="#_5-3-external-auth-tree-selection" aria-label="Permalink to &quot;5.3 External Auth + Tree Selection&quot;">​</a></h3><p><strong>目标</strong>：结合 <code>env.asExternalUri</code> 完成浏览器 OAuth，并在完成后刷新 Tree View。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> startLogin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> callbackUri</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vscode.Uri.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vscode://cloud-ext/auth&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> externalUri</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vscode.env.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">asExternalUri</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(callbackUri);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vscode.env.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openExternal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vscode.Uri.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`https://login.example.com?redirect_uri=${</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encodeURIComponent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">externalUri</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">())</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vscode.window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registerUriHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleUri</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">uri</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (uri.path </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/auth&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URLSearchParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uri.query).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">token) { vscode.window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">showErrorMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;缺少 token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> saveToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(token);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> provider.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">refresh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    treeView.message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;云账户已连接&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="_6-运行时考量" tabindex="-1">6. 运行时考量 <a class="header-anchor" href="#_6-运行时考量" aria-label="Permalink to &quot;6. 运行时考量&quot;">​</a></h2><ul><li>Handler 不应执行长阻塞任务，可调用后台 Promise 并让 UI 显示加载信息；</li><li>若需要同时处理多个 URI，可引入队列，确保 <code>TreeView.reveal</code> 顺序执行；</li><li>需支持无工作区场景的提示（要求用户打开对应工作区后重试）。</li></ul><h2 id="_7-未来演进" tabindex="-1">7. 未来演进 <a class="header-anchor" href="#_7-未来演进" aria-label="Permalink to &quot;7. 未来演进&quot;">​</a></h2><ul><li>官方提供深链声明文件，自动生成 Handler/Link Builder；</li><li>支持跨工作区透明跳转，在 URI 中携带 workspace hint；</li><li>增加 URI 调试控制台，便于测试不同参数组合。</li></ul><h2 id="_8-端到端联调清单" tabindex="-1">8. 端到端联调清单 <a class="header-anchor" href="#_8-端到端联调清单" aria-label="Permalink to &quot;8. 端到端联调清单&quot;">​</a></h2><ol><li><strong>Schema 设计</strong>：统一 <code>/reveal</code>、<code>/auth</code>、<code>/action/&lt;name&gt;</code> 等路径，文档化所有参数；</li><li><strong>安全机制</strong>：为敏感链接附加一次性 token/HMAC，并在 Handler 中验证时间戳及来源；</li><li><strong>容器切换</strong>：Reveal 前执行 <code>workbench.view.extension.&lt;container&gt;</code> 并等待 Tree View visibility 事件；</li><li><strong>Provider 缓存</strong>：实现 <code>resolveNodeById</code>，兼容缓存 miss 时的递归加载与错误兜底；</li><li><strong>测试矩阵</strong>：覆盖浏览器、IM、终端等入口触发 URI，并模拟失败（缺参、节点不存在、权限不足）确保提示友好。</li></ol></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><!----><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>Last updated: <time datetime="2025-12-05T10:52:56.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/vscode-tree-view-spec/uri-handler-and-deep-links-srs.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>事实需求 SRS</span><!--]--></a></div><div class="pager" data-v-e257564d><!----></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>为 VSCode Tree View 生态编写的规格与设计指南（模拟版）</p><p class="copyright" data-v-e315a0ad>以开放协作为目标的内部模拟文档</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"Ct6SFrcL\",\"vscode-tree-view-spec_activation-and-context-system-sdd.md\":\"CgufGbuD\",\"vscode-tree-view-spec_activation-and-context-system-srs.md\":\"Dob8r1VQ\",\"vscode-tree-view-spec_commands-menus-and-keybindings-sdd.md\":\"BwDxjSlh\",\"vscode-tree-view-spec_commands-menus-and-keybindings-srs.md\":\"DZT_6R3B\",\"vscode-tree-view-spec_configuration-and-settings-sdd.md\":\"BRXQdVxt\",\"vscode-tree-view-spec_configuration-and-settings-srs.md\":\"D_T4FK-n\",\"vscode-tree-view-spec_index.md\":\"DkZw4Vji\",\"vscode-tree-view-spec_tree-view-sdd.md\":\"C-TQS8wO\",\"vscode-tree-view-spec_tree-view-srs.md\":\"BuKTGN9m\",\"vscode-tree-view-spec_uri-handler-and-deep-links-sdd.md\":\"DMCA_iQ7\",\"vscode-tree-view-spec_uri-handler-and-deep-links-srs.md\":\"CJ_HvsVA\",\"vscode-tree-view-spec_workbench-views-and-containers-sdd.md\":\"C0Gde_Ge\",\"vscode-tree-view-spec_workbench-views-and-containers-srs.md\":\"DXPDVQZw\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"VS Code 规格与设计\",\"description\":\"以“假装 Visual Studio Code 官方团队”的身份，汇总关键能力的事实需求（SRS）与设计指导（SDD）\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":false,\"themeConfig\":{\"nav\":[{\"text\":\"Tree View 生态\",\"link\":\"/vscode-tree-view-spec/\"}],\"sidebar\":{\"/vscode-tree-view-spec/\":[{\"text\":\"Tree View 生态\",\"items\":[{\"text\":\"章节总览\",\"link\":\"/vscode-tree-view-spec/\"}]},{\"text\":\"核心 API｜Tree View 主域\",\"items\":[{\"text\":\"事实需求 SRS\",\"link\":\"/vscode-tree-view-spec/tree-view-srs\"},{\"text\":\"设计指导 SDD\",\"link\":\"/vscode-tree-view-spec/tree-view-sdd\"}]},{\"text\":\"Workbench 视图与容器\",\"items\":[{\"text\":\"事实需求 SRS\",\"link\":\"/vscode-tree-view-spec/workbench-views-and-containers-srs\"},{\"text\":\"设计指导 SDD\",\"link\":\"/vscode-tree-view-spec/workbench-views-and-containers-sdd\"}]},{\"text\":\"命令 / 菜单 / 快捷键\",\"items\":[{\"text\":\"事实需求 SRS\",\"link\":\"/vscode-tree-view-spec/commands-menus-and-keybindings-srs\"},{\"text\":\"设计指导 SDD\",\"link\":\"/vscode-tree-view-spec/commands-menus-and-keybindings-sdd\"}]},{\"text\":\"激活与上下文系统\",\"items\":[{\"text\":\"事实需求 SRS\",\"link\":\"/vscode-tree-view-spec/activation-and-context-system-srs\"},{\"text\":\"设计指导 SDD\",\"link\":\"/vscode-tree-view-spec/activation-and-context-system-sdd\"}]},{\"text\":\"配置与设置\",\"items\":[{\"text\":\"事实需求 SRS\",\"link\":\"/vscode-tree-view-spec/configuration-and-settings-srs\"},{\"text\":\"设计指导 SDD\",\"link\":\"/vscode-tree-view-spec/configuration-and-settings-sdd\"}]},{\"text\":\"URI Handler 与深链\",\"items\":[{\"text\":\"事实需求 SRS\",\"link\":\"/vscode-tree-view-spec/uri-handler-and-deep-links-srs\"},{\"text\":\"设计指导 SDD\",\"link\":\"/vscode-tree-view-spec/uri-handler-and-deep-links-sdd\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/irideas/vscode-spec-sham\"}],\"footer\":{\"message\":\"为 VSCode Tree View 生态编写的规格与设计指南（模拟版）\",\"copyright\":\"以开放协作为目标的内部模拟文档\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>